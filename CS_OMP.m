%  1-D?????????(???????Orthogonal Matching Pursuit)
%  ???M>=K*log(N/K),K????,N????,????????
%  ???--????????? ??  Email: wsha@eee.hku.hk
%  ?????2008?11?18?
%  ????: http://www.eee.hku.hk/~wsha/Freecode/freecode.htm 
%  ?????Joel A. Tropp and Anna C. Gilbert 
%  Signal Recovery From Random Measurements Via Orthogonal Matching
%  Pursuit?IEEE TRANSACTIONS ON INFORMATION THEORY, VOL. 53, NO. 12,
%  DECEMBER 2007.

clc;clear

%%  1. ????????
K=7;      %  ???(?FFT?????)
N=256;    %  ????
M=64;     %  ???(M>=K*log(N/K),??40,???????)
f1=50;    %  ????1
f2=100;   %  ????2
f3=200;   %  ????3
f4=400;   %  ????4
fs=800;   %  ????
ts=1/fs;  %  ????
Ts=1:N;   %  ????
x=0.3*cos(2*pi*f1*Ts*ts)+0.6*cos(2*pi*f2*Ts*ts)+0.1*cos(2*pi*f3*Ts*ts)+0.9*cos(2*pi*f4*Ts*ts);  %  ????

%%  2.  ????????
Phi=randn(M,N);                                   %  ????(???????)
s=Phi*x.';                                        %  ?????? 

%%  3.  ???????????(????L_1???????)
m=2*K;                                            %  ??????(m>=K)
Psi=fft(eye(N,N))/sqrt(N);                        %  ????????
T=Phi*Psi';                                       %  ????(????*???????)

hat_y=zeros(1,N);                                 %  ??????(???)??                     
Aug_t=[];                                         %  ????(???????)
r_n=s;                                            %  ???

for times=1:m;                                    %  ????(???????,??????K)
    for col=1:N;                                  %  ??????????
        product(col)=abs(T(:,col)'*r_n);          %  ????????????????(???) 
    end
    [val,pos]=max(product);                       %  ???????????
    Aug_t=[Aug_t,T(:,pos)];                       %  ????
    T(:,pos)=zeros(M,1);                          %  ?????????????????????????
    aug_y=(Aug_t'*Aug_t)^(-1)*Aug_t'*s;           %  ????,?????
    r_n=s-Aug_t*aug_y;                            %  ??
    pos_array(times)=pos;                         %  ???????????
end
hat_y(pos_array)=aug_y;                           %  ???????
hat_x=real(Psi'*hat_y.');                         %  ???????????????

%%  4.  ???????????
figure(1);
hold on;
plot(hat_x,'k.-')                                 %  ????
plot(x,'r')                                       %  ????
legend('Recovery','Original')
norm(hat_x.'-x)/norm(x)                           %  ????